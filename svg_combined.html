<!DOCTYPE html>
<html lang="utf-8">

	<head>
	 	
		<meta charset="utf-8">
		<!-- Required meta tags always come first --
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Title Page</title>

		<!-- Bootstrap CSS -->

		<link rel="stylesheet" href="bootstrap/css/bootstrap.css">

		<script src="js/w3color.js" type="text/javascript"></script>
	</head>
	<body>
		<style type="text/css" media="screen">
			svg
			{
				fill:white;
				stroke:#000;
				stroke-width:5;
				text-align: center;
			}
			table
			{
				border-collapse: collapse;
				border :2px solid #000;
				width:100%;
			}
			td
			{
				border:1px solid #000;
				padding: 10px;
				font-size: 12px;
				width:25%;
			}
		</style>
		<!-- jQuery -->
		<script src="jQuery/jQuery-2.1.3.min.js"></script>
		<!-- Bootstrap JavaScript -->
		<script src="bootstrap/js/bootstrap.js"></script>
		<script src="http://mbostock.github.com/d3/d3.v2.js"></script>
		<script type="text/javascript">
			$(function(){
				var current_line_pos = 0;
				var rbi_cnt = 0;
				var svgContainer = d3.select("#svg_container").append("svg")
	                                     .attr("width", 600)
	                                     .attr("height", 600);

	             var center_x = 300;
	             var center_y = 300;
	             var base_x = 50;
	             var base_y = 50;
	             var width = 500;
	             var height = 500;
	 
				 //Draw the Rectangle
				 var rectangle = svgContainer.append("rect")
				                             .attr("x", base_x)
				                             .attr("y", base_y)
				                            .attr("width", width)
				                            .attr("height", height)
				                            .attr("stroke-width", 10);

				var circle_x = base_x + 160;
                var circle_y = height - 20;
                var circle_left_offset = 35;
				var r = 15;
		       
				var rand_color = "#000";

				
				var poly_offset = 80; 
	            var cx = new Array((width / 2) + base_x , width + base_x - poly_offset, (width / 2) + base_x,  poly_offset + base_x);
	            var cy = new Array(height + base_y - poly_offset ,(height / 2) + base_y,poly_offset + base_y,(height / 2) + base_y);

				var textData = [
				   { "cx": cx[1] - 30, "cy": cy[1], "radius": 20, "color" : "green", "text" : "1" },
				   { "cx": cx[1] - 30, "cy": cy[1], "radius": 20, "color" : "green", "text" : "1" },
				   { "cx": cx[2] + 20, "cy": cy[2], "radius": 20, "color" : "green", "text" : "2" },
				   { "cx": cx[3] + 20, "cy": cy[3], "radius": 20, "color" : "green", "text" : "3" },
				   { "cx": cx[0] + 20, "cy": cy[0], "radius": 20, "color" : "green", "text" : "4" },
				];

				var line_add = function(fir, sec){
	             	var line = svgContainer.append("line")
                          .attr("x1", cx[fir -1]).attr("y1", cy[fir -1])
                          .attr("x2", cx[sec - 1]).attr("y2", cy[sec -1])
                          .attr("stroke-width", 5)
                          .attr("id", "line_add" + fir)
                          .attr("display", "none")
                          .attr("stroke", "#ccc")
                          .attr("line_type", "add");
	             }
	             
         		var line_fut_add = function(fir, sec){
	             	var line = svgContainer.append("line")
                          .attr("x1", cx[fir -1] ).attr("y1", cy[fir -1])
                          .attr("x2", cx[sec - 1] ).attr("y2", cy[sec -1])
                          .attr("stroke-width", 5)
                          .attr("id", "line_fut_add" + fir)
                          .attr("display", "none")
                          .attr("stroke", "#ccc")
                          .attr("line_type", "future");
	             }
	             
	            line_fut_add(1, 2);
         		line_fut_add(2, 3);
         		line_fut_add(3, 4);
         		line_fut_add(4, 1);
				
				line_add(1, 2);
         		line_add(2, 3);
         		line_add(3, 4);
         		line_add(4, 1);


				for(i = 0; i < 4; i++)
			 	{
			 		r = 15;
			 		svgContainer.append("circle")
                     .attr("cx", circle_x - i * circle_left_offset)
                     .attr("cy", circle_y)
                     .attr("r", r)
                     .attr("stroke-width", 3)
                     .attr("id", "rbi_circle")
                     .attr("circle_type", "round_circle")
                     .attr("display", "none")
                     .attr("stroke", "#ccc");

                    r=20;
	                var circle1 = svgContainer.append("circle")
	                 .attr("cx", cx[i]).attr("cy", cy[i]).attr("r", r)
	                 .attr("stroke-width", 1)
	                 .attr("id", "hover_pink_circle" + (i + 1))
	                 .attr("fill", "pink")
	                 .attr("stroke", "pink")
	                 .attr("color","pink")
	                 .attr("stroke","pink")
	                 .attr("circle_id", (i+1))
	                 .attr("circle_type", "hover_circle")
	                 .attr("display", "none")
	                 .attr("real_id", (i + 1));

	                r = 15;
	             	var circle = svgContainer.append("circle")
                     .attr("cx", cx[i]).attr("cy", cy[i]).attr("r", r)
                     .attr("stroke-width", 1)
                     .attr("id", "hover_grey_circle" + (i + 1))	
                     .attr("circle_id", (i + 1))
                     .attr("fill", "#ccc")
                     .attr("stroke", "#ccc")
                     .attr("circle_type", "hover_grey_circle")
                     .attr("display", "none")
                     .attr("real_id", (i + 1));
			 	}
 				
	            var tmpDataset = [{first:"POSITION", second:"0"}];

				var text_div = d3.select("#text_container")
				    .append("table");
				    
				
				var table_parse = function()
				{
					return;
					var cnt = $("body  #line_add").length;
					var trs = text_div.selectAll("table")
				    .data([{first: "POSITION", second:cnt}])
				    .enter().append("tr")
				    .attr("id", "pos_row");
				    
					trs.append('td').html(function(m) { return m.first; });

					trs.append('td').html(function(m) { return m.second; });		


					var tr = text_div.selectAll("table")
					.data([{first:"RBI", second: 0}])
					.enter()
					.append("tr")
					.style("border-collapse", "collapse")
				    .style("border", "2px #000 solid")
				    .attr("id", "tr_row");


					tr.append('td').html(function(m) { return m.first; });

					tr.append('td').html(function(m) { return m.second; });
				}
				
				table_parse();

	            var pink_circle_hover = function(ind)
	            {
	             	for(i = 0; i < 4; i++) {
	             		var id = "#pink_circle" + i;
	             		$(id).css('opacity', '0');
	             		if(i == ind)
	             			$(id).css('opacity', '1');
	             	}
	            }

	            var show_items = function(bShow)
	            {
	            	if(bShow)
	            	{
		            	svgContainer.selectAll("circle[circle_type ='hover_grey_circle']")
		             	.attr("display", "");

		             	svgContainer.selectAll("circle[circle_type ='round_circle']")
		             	.attr("display", "");	
	            	}
	            	else
	            	{
		            	svgContainer.selectAll("circle[circle_type ='hover_grey_circle']")
		             	.attr("display", "none");

		             	svgContainer.selectAll("circle[circle_type ='round_circle']")
		             	.attr("display", "none");	
	            	}
	            }

	            var show_fut_line = function(bShow, id)
	            {
	            	if(!bShow)
	            	{
						svgContainer.selectAll("line[line_type ='future']").attr("display", "none");
	            	}
	            	else
	            	{

						var line_id = "line_fut_add" + id;
						
						svgContainer.selectAll("#"+line_id).attr("display", "");
	            	}
	            }

	            var check_rbi_count = function()
	            {
					$('#dummy').css('color','#000');
                	var color = $('#dummy').css('color');
                	rbi_cnt = 0;

                	svgContainer.selectAll("circle[circle_type='round_circle']")
                	.each(function() {
                		var fill_color = $(this).css("fill");

	                	if(fill_color == color)
	                		rbi_cnt++;
                	});
	            }


	            var show_line = function(bShow, id)
	            {
	            	if(!bShow)
	            	{
						svgContainer.selectAll("line[line_type ='add']").attr("display", "none")
						.attr("stroke", "#ccc")
						.attr("fill", "#ccc");

						svgContainer.selectAll("circle[circle_type = 'hover_grey_circle']")
						.attr("stroke", "#ccc")
						.attr("fill", "#ccc");
	            	}
	            	else
	            	{
						var line_id = "line_add" + id;
					
						svgContainer.selectAll("#"+line_id).attr("display", "")
						.attr("stroke", "#000")
						.attr("fill", "#000");

						svgContainer.selectAll("#hover_grey_circle" + id)
						.attr("stroke", "#000")
						.attr("fill", "#000");
	            	}
	            }


				var draw_content = function()
				{
					var lines = 0;
					svgContainer.selectAll("line[line_type ='add']").each(function()
					{
						var display = $(this).css("display");
						if(display != "none")
							lines++;
					});

					var pa = 0;
					if((rbi_cnt + lines) > 0)
						pa = 1;

					var span = $("#content")[0];
					span.innerHTML = "RBI:" + rbi_cnt 
						+ "<br/>" + "POSITION:" + lines 
						+ "<br/>" + "PA:" + pa;
				}

				var draw_rbi = function()
				{
					svgContainer.selectAll("#rbi_circle").each(function() {
						$('#dummy').css('color','#000');
	                	var color = $('#dummy').css('color');

	                	var fill_color = $(this).css("fill");

	                	if(fill_color != color)
					 		$(this).attr("stroke", "#ccc");
	            	});
				}
	            svgContainer.selectAll("rect").on("mouseover" , function() {
	            	draw_rbi();
	             	show_items(true);
	            });

	            svgContainer.selectAll("rect").on("mouseout" , function() {
	            	svgContainer.selectAll("#rbi_circle").each(function() {
						$('#dummy').css('color','#000');
	                	var color = $('#dummy').css('color');

	                	var fill_color = $(this).css("fill");

	                	if(fill_color != color)
					 		$(this).attr("stroke", "white");
	            	});
	            	
	            	if((current_line_pos > 0) || (rbi_cnt > 0)) return;
	             	show_items(false);
	            });

	            svgContainer.selectAll("circle[circle_type ='hover_grey_circle']").on("click", function(d) {
	             	var id = $(this).attr("circle_id");

	             	var line_cnt = 0;
					svgContainer.selectAll("line[line_type ='add']").each(function()
					{
						var display = $(this).css("display");
						if(display != "none")
							line_cnt++;
					});						
					
	             	if(line_cnt == 4)
	             	{
	             		current_line_pos = 0;
	             		show_line(false, 0);
	             		show_fut_line(false, 0);
	             		draw_content();
	             		return;
	             	}

	             	current_line_pos = id;

					show_fut_line(false, id);
					show_line(false, id);
					
					if(id == 1) id =5;
					for(i = 1; i<id; i++)
					{
						show_line(true, i);
					}
					
					draw_content();
					$(this).attr("stroke", "#000").attr("fill","#000");
				 });

	            var check_related_line = function(id)
	            {
	            	if(id == 0)	return true;
	            	var line_id = "line_add" + id;

					var line_display = svgContainer.selectAll("#"+line_id).attr("display");
					if(line_display != "none")
						return true;	
					else
						return false;

	            }

				svgContainer.selectAll("circle[circle_type ='hover_grey_circle']").on("mouseover", function() {
					draw_rbi();
				 	var id = $(this).attr("circle_id");

				 	show_items(true);

             		$("#hover_pink_circle" + id).attr("display", "");
             		show_fut_line(false, id);
             		
             		if(id == 1) id=5;
             		for(i = 1;i <id; i++)
             			show_fut_line(true, i);

					$(this).attr("stroke", "#000").attr("fill","#000");
				 });

				 svgContainer.selectAll("circle[circle_type ='hover_grey_circle']").on("mouseout", function(){
				 	draw_rbi();
				 	svgContainer.selectAll("circle[circle_type ='hover_circle']")
	             	.attr("display", "none");

	             	show_fut_line(false, 0);

	             	var related_line = check_related_line($(this).attr("real_id") - 1);
	             	if(!related_line)
				 		$(this).attr("stroke", "#ccc").attr("fill","#ccc");
				 });

				 svgContainer.selectAll("#rbi_circle").on("mouseover", function(d) {
				 	draw_rbi();
					$(this).attr("stroke", "#000") ;

				 	show_items(true);
				 });

				 svgContainer.selectAll("line").on("mouseout", function(){
				 	draw_rbi();
				 });

				 svgContainer.selectAll("line").on("mouseover", function(d) {
				 	draw_rbi();
				 });

				 svgContainer.selectAll("#rbi_circle").on("mouseout", function(d) {
				 	$('#dummy').css('color','#000');
                	var color = $('#dummy').css('color');

                	var fill_color = $(this).css("fill");

                	if(fill_color != color)
				 		$(this).attr("stroke", "#ccc") ;

				 	show_items(true);
				 });
				
				svgContainer.selectAll("#rbi_circle").on("click", function(d) {
					$(this).attr("stroke", "#000") ;
                	show_items(true);

                	$('#dummy').css('color','white');
                	var color = $('#dummy').css('color');

                	var fill_color = $(this).css("fill");

                	if(fill_color == color)
                		$(this).css("fill", "#000");
                	else
                		$(this).css("fill", "white");

                	check_rbi_count();
                	draw_content();
				 });
				draw_content();
		});

		</script>
		<div class="container">
		  	<div class="row col-md-12 text-center" id="svg_container"></div>
		  	<div class="row col-md-12 text-center" id="text_container"></div>
			<div id="dummy" style="display:none;"></div>
			<div><span id="content"></span></div>
		</div>
	</body>
</html>
